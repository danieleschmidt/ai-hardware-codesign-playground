{
  "name": "Production Deployment",
  "on": {
    "push": {
      "branches": [
        "main"
      ]
    },
    "pull_request": {
      "branches": [
        "main"
      ]
    }
  },
  "jobs": {
    "test": {
      "runs-on": "ubuntu-latest",
      "steps": [
        {
          "name": "Checkout code",
          "uses": "actions/checkout@v3"
        },
        {
          "name": "Set up Python",
          "uses": "actions/setup-python@v4",
          "with": {
            "python-version": "3.11"
          }
        },
        {
          "name": "Install dependencies",
          "run": "pip install -r requirements.txt"
        },
        {
          "name": "Run tests",
          "run": "python test_autonomous_sdlc_validation.py"
        },
        {
          "name": "Run quality gates",
          "run": "python security_performance_quality_gates.py"
        }
      ]
    },
    "security-scan": {
      "runs-on": "ubuntu-latest",
      "steps": [
        {
          "name": "Run Trivy vulnerability scanner",
          "uses": "aquasecurity/trivy-action@master",
          "with": {
            "scan-type": "fs",
            "scan-ref": "."
          }
        }
      ]
    },
    "build-and-deploy": {
      "needs": [
        "test",
        "security-scan"
      ],
      "runs-on": "ubuntu-latest",
      "if": "github.ref == 'refs/heads/main'",
      "steps": [
        {
          "name": "Build Docker image",
          "run": "docker build -t codesign-playground:latest -f production_deployment/docker/Dockerfile.production ."
        },
        {
          "name": "Deploy to production",
          "run": "kubectl apply -f production_deployment/kubernetes/"
        }
      ]
    }
  }
}